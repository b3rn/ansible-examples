---
## This playbook deploys the whole application stack in this site.  

# Apply common configuration to all hosts
- hosts: all
  vars:
    group_dbservers: tag_ansible_group_dbservers
    group_lbservers: tag_ansible_group_lbservers
    group_monitoring: tag_ansible_group_monitoring
    group_webservers: tag_ansible_group_webservers
    repository: "https://github.com/b3rn/mywebapp.git"
    webapp_version: HEAD
 
  roles:
  - common

# Configure and deploy database servers.
- hosts: "{{ group_dbservers }}"
  
  roles:
  - db
  
  tags:
  - db

# Configure and deploy the web servers. Note that we include two roles here, 
# the 'base-apache' role which simply sets up Apache, and 'web' which includes
# our example web application.
- hosts: "{{ group_webservers }}"
  

  roles:
  - base-apache
  - web
  
  tags:
  - web

# Configure and deploy the load balancer(s).
- hosts: "{{ group_lbservers }}"
  
  roles:
  - haproxy
  
  tags:
  - lb

# Configure and deploy the Nagios monitoring node(s).
- hosts: "{{ group_monitoring }}"
  
  roles:
  - base-apache
  - nagios
  
  tags:
  - monitoring
